norm_noise_periode <- 1e9     # ~constant variance (cos ~ 1)
shift_norm_noise <- 0
non_normal_noise_magnitue <- 0
non_norm_noice_periode <- 1e9
shift_non_norm_noise <- 0
y.gen <- y_gen(
contant=contant, trend=trend, curve_magnitue=curve_magnitue, curve_period=curve_period,
curve_shift=curve_shift, normal_noise_magnitue=normal_noise_magnitue, norm_noise_periode=norm_noise_periode,
shift_norm_noise=shift_norm_noise, non_normal_noise_magnitue=non_normal_noise_magnitue,
non_norm_noice_periode=non_norm_noice_periode, shift_non_norm_noise=shift_non_norm_noise
)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="A) Data (assumptions hold)", y="y")
# ---- A: All assumptions hold ----
set.seed(1)
contant <- 0
trend <- 0.2                # linear trend
curve_magnitue <- 0           # no curvature
curve_period <- 100
curve_shift <- 0
normal_noise_magnitue <- 1
norm_noise_periode <- 1e9     # ~constant variance (cos ~ 1)
shift_norm_noise <- 0
non_normal_noise_magnitue <- 0
non_norm_noice_periode <- 1e9
shift_non_norm_noise <- 0
y.gen <- y_gen(
contant=contant, trend=trend, curve_magnitue=curve_magnitue, curve_period=curve_period,
curve_shift=curve_shift, normal_noise_magnitue=normal_noise_magnitue, norm_noise_periode=norm_noise_periode,
shift_norm_noise=shift_norm_noise, non_normal_noise_magnitue=non_normal_noise_magnitue,
non_norm_noice_periode=non_norm_noice_periode, shift_non_norm_noise=shift_non_norm_noise
)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="A) Data (assumptions hold)", y="y")
lm.gen <- lm(y.gen ~ x)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="A) Data (assumptions hold)", y="y")
lm.gen <- lm(y.gen ~ x)
plot(lm.gen, which = 1)  # Residuals vs Fitted (should be patternless)
plot(lm.gen, which = 2)  # Q-Q (close to line)
plot(lm.gen, which = 3)  # Scale-Location (flat-ish)
plot(lm.gen, which = 5)  # Leverage (no standout points)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="A) Data (assumptions hold)", y="y")
lm.gen <- lm(y.gen ~ x)
plot(lm.gen, which = 1)  # Residuals vs Fitted (should be patternless)
plot(lm.gen, which = 2)  # Q-Q (close to line)
plot(lm.gen, which = 3)  # Scale-Location (flat-ish)
plot(lm.gen, which = 5)  # Leverage (no standout points)
# ---- B: Heteroscedasticity ----
set.seed(2)
contant <- 0
trend <- 0.01
curve_magnitue <- 0
curve_period <- 100
curve_shift <- 0
normal_noise_magnitue <- 1
shift_norm_noise <- 0
non_normal_noise_magnitue <- 0
non_norm_noice_periode <- 1e9
shift_non_norm_noise <- 0
y.gen <- y_gen(
contant=contant, trend=trend, curve_magnitue=curve_magnitue, curve_period=curve_period,
curve_shift=curve_shift, normal_noise_magnitue=normal_noise_magnitue, norm_noise_periode=norm_noise_periode,
shift_norm_noise=shift_norm_noise, non_normal_noise_magnitue=non_normal_noise_magnitue,
non_norm_noice_periode=non_norm_noice_periode, shift_non_norm_noise=shift_non_norm_noise
)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="B) Data (heteroscedastic)", y="y")
lm.gen <- lm(y.gen ~ x)
plot(lm.gen, which = 1)  # Residuals vs Fitted: changing spread (violates homoscedasticity)
plot(lm.gen, which = 2)  # Q-Q
plot(lm.gen, which = 3)  # Scale-Location: upward/downward pattern (non-constant variance)
plot(lm.gen, which = 5)  # Leverage
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="B) Data (heteroscedastic)", y="y")
lm.gen <- lm(y.gen ~ x)
plot(lm.gen, which = 1)  # Residuals vs Fitted: changing spread (violates homoscedasticity)
plot(lm.gen, which = 2)  # Q-Q
plot(lm.gen, which = 3)  # Scale-Location: upward/downward pattern (non-constant variance)
plot(lm.gen, which = 5)  # Leverage
lm.gen
plot(lm.gen, which = 1)  # Residuals vs Fitted: changing spread (violates homoscedasticity)
plot(lm.gen, which = 2)  # Q-Q
plot(lm.gen, which = 3)  # Scale-Location: upward/downward pattern (non-constant variance)
# ---- B: Heteroscedasticity ----
set.seed(2)
contant <- 0
trend <- 0.01
curve_magnitue <- 0
curve_period <- 100
normal_noise_magnitue <- 1
norm_noise_periode <- 500      # variance oscillates strongly across x
shift_norm_noise <- 0
non_normal_noise_magnitue <- 0
non_norm_noice_periode <- 1e9
shift_non_norm_noise <- 0
y.gen <- y_gen(
contant=contant, trend=trend, curve_magnitue=curve_magnitue, curve_period=curve_period,
curve_shift=curve_shift, normal_noise_magnitue=normal_noise_magnitue, norm_noise_periode=norm_noise_periode,
shift_norm_noise=shift_norm_noise, non_normal_noise_magnitue=non_normal_noise_magnitue,
non_norm_noice_periode=non_norm_noice_periode, shift_non_norm_noise=shift_non_norm_noise
)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="B) Data (heteroscedastic)", y="y")
lm.gen <- lm(y.gen ~ x)
plot(lm.gen, which = 1)  # Residuals vs Fitted: changing spread (violates homoscedasticity)
plot(lm.gen, which = 2)  # Q-Q
plot(lm.gen, which = 3)  # Scale-Location: upward/downward pattern (non-constant variance)
plot(lm.gen, which = 5)  # Leverage
# ---- C: Nonlinearity ----
set.seed(3)
contant <- 0
trend <- 0.0                  # keep linear part minimal to expose curvature
curve_magnitue <- 20          # visible curvature
curve_period <- 100           # periodic curve in mean
curve_shift <- 0
normal_noise_magnitue <- 1
norm_noise_periode <- 1e9     # ~constant variance to isolate nonlinearity
shift_norm_noise <- 0
non_normal_noise_magnitue <- 0
shift_non_norm_noise <- 0
y.gen <- y_gen(
contant=contant, trend=trend, curve_magnitue=curve_magnitue, curve_period=curve_period,
curve_shift=curve_shift, normal_noise_magnitue=normal_noise_magnitue, norm_noise_periode=norm_noise_periode,
shift_norm_noise=shift_norm_noise, non_normal_noise_magnitue=non_normal_noise_magnitue,
non_norm_noice_periode=non_norm_noice_periode, shift_non_norm_noise=shift_non_norm_noise
)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="C) Data (nonlinear mean)", y="y")
lm.gen <- lm(y.gen ~ x)
plot(lm.gen, which = 1)  # Residuals vs Fitted: curved pattern (violates linearity)
plot(lm.gen, which = 2)  # Q-Q
plot(lm.gen, which = 3)  # Scale-Location
plot(lm.gen, which = 5)  # Leverage
# ---- D: Non-normal residuals ----
set.seed(4)
contant <- 0
curve_magnitue <- 0
curve_period <- 100
curve_shift <- 0
normal_noise_magnitue <- 0     # turn off normal part to isolate non-normality
norm_noise_periode <- 1e9
shift_norm_noise <- 0
non_normal_noise_magnitue <- 1 # exponential noise component on
non_norm_noice_periode <- 1e9  # ~constant scale
shift_non_norm_noise <- 0
y.gen <- y_gen(
contant=contant, trend=trend, curve_magnitue=curve_magnitue, curve_period=curve_period,
curve_shift=curve_shift, normal_noise_magnitue=normal_noise_magnitue, norm_noise_periode=norm_noise_periode,
shift_norm_noise=shift_norm_noise, non_normal_noise_magnitue=non_normal_noise_magnitue,
non_norm_noice_periode=non_norm_noice_periode, shift_non_norm_noise=shift_non_norm_noise
)
qplot(x, y.gen) + geom_point(size=0.1) + labs(title="D) Data (non-normal errors)", y="y")
lm.gen <- lm(y.gen ~ x)
plot(lm.gen, which = 1)  # Residuals vs Fitted
plot(lm.gen, which = 2)  # Q-Q: systematic deviations (skew/heavy tails)
plot(lm.gen, which = 3)  # Scale-Location
plot(lm.gen, which = 5)  # Leverage
plot(lm.gen, which = 5)  # Leverage
---
title: "assignment1"
knitr::opts_chunk$set(echo = TRUE)
setwd("C:/Users/kristianrohne/OneDrive - Norwegian University of Life Sciences/NMBU/Fall2025/dat320/assignment1")
library(lubridate)
library(lubridate)
library(dplyr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(fastDummies)
library(readr)
library(lubridate)
library(dplyr)
library(ggplot2)
library(tidyr)
library(fastDummies)
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("C:/Users/kristianrohne/OneDrive - Norwegian University of Life Sciences/NMBU/Fall2025/dat320/assignment1")
# For interactive plotting in popup windows
if (interactive()) {
# For Windows - open plots in separate window
if (.Platform$OS.type == "windows") {
options(device = "windows")
} else {
options(device = "X11")
}
}
# For interactive plotting in popup windows
if (interactive()) {
# For Windows - open plots in separate window
if (.Platform$OS.type == "windows") {
options(device = "windows")
} else {
options(device = "X11")
}
}
## Exercise 1: Air Pollution Analysis
### A) Data Loading and Preprocessing
```{r load-data}
data <- read.csv("air_polution.csv",
stringsAsFactors = FALSE,
fileEncoding = "UTF-8")
# Inspect
str(data)
head(data)
summary(data)
# Inspect
str(data)
head(data)
summary(data)
```{r data-conversion}
data <- data %>%
mutate(
area = as.factor(area),              # convert area to factor
station = as.factor(station),        # convert station to factor
component = as.factor(component),    # convert component to factor
dateTime = as.POSIXct(dateTime)       # convert dateTime to POSIXct (date-time)
)
```{r inspect-data}
summary(data)
# Inspect result
str(data)
summary(data)
### B & C) Time Range Analysis
```{r time-ranges}
time_ranges <- data %>%
# make timeseries of each combination of area, station and component
group_by(area, station, component) %>%
summarise(
# Add start_data and end_date columns
start_date = min(dateTime),
end_date   = max(dateTime),
mean_value   = mean(value),
sd_value     = sd(value),
median_value = median(value),
min_value    = min(value),
max_value    = max(value),
# For getting a clean summary table
.groups = "drop"
)
time_ranges
time_ranges
time_ranges
```
```{r}
make_pm_plot <- function(data, pm_type) {
data_filtered= data %>%
filter(component == pm_type)
ggplot(data_filtered ,aes(x = dateTime, y = value, color = area)) +
geom_line() +
labs(
title = paste(pm_type, "over time"),
x = "Date",
y = bquote(.(pm_type) ~ "(" * mu * "g/m"^3 * ")"),
color = "Area"
)
}
ggplot(data_filtered ,aes(x = dateTime, y = value, color = area)) +
geom_line() +
labs(
title = paste(pm_type, "over time"),
x = "Date",
y = bquote(.(pm_type) ~ "(" * mu * "g/m"^3 * ")"),
color = "Area"
)
```{r}
# PM2.5 plot
pm25_plot <- make_pm_plot(data, "PM2.5")
# For popup window display
if (interactive()) {
windows()  # Opens new window on Windows
print(pm25_plot)
} else {
pm25_plot  # For knitting
}
# For popup window display
if (interactive()) {
windows()  # Opens new window on Windows
print(pm25_plot)
} else {
pm25_plot  # For knitting
}
```{r}
# PM10 plot
pm10_plot <- make_pm_plot(data, "PM10")
pm10_plot
d)
```{r}
sum(is.na(data))
sum(is.na(data))
```{r}
e)
```{r}
# PM2.5 plot
pm25_plot <- make_pm_plot(data_aug2025, "PM2.5")
pm25_plot
# PM2.5 plot
pm25_plot <- make_pm_plot(data_aug2025, "PM2.5")
```{r}
```{r}
# PM10 plot
pm10_plot <- make_pm_plot(data_aug2025, "PM10")
pm10_plot
# PM10 plot
pm10_plot <- make_pm_plot(data_aug2025, "PM10")
```{r}
g)
```{r}
make_pm_boxplot <- function(data, pm_type) {
data_filtered= data %>%
filter(component == pm_type)
ggplot(data_filtered, aes(x = area, y = value, fill = area)) +
geom_boxplot() +
facet_wrap(~ component, scales = "free_y")
}
make_pm_boxplot <- function(data, pm_type) {
data_filtered= data %>%
filter(component == pm_type)
ggplot(data_filtered, aes(x = area, y = value, fill = area)) +
geom_boxplot() +
facet_wrap(~ component, scales = "free_y")
}
```{r}
# PM2.5 plot
pm25_boxplot <- make_pm_boxplot(data, "PM2.5")
pm25_boxplot
pm25_boxplot
# PM10 plot
pm10_boxplot <- make_pm_boxplot(data, "PM10")
# PM10 plot
pm10_boxplot <- make_pm_boxplot(data, "PM10")
pm10_boxplot
Excercise 2)
```{r}
library(readr)
temp_data <- read_csv2(
"temperature_data.csv",
col_types = cols(
area     = col_character(),
station  = col_character(),
dateTime = col_date(format = "%d.%m.%Y"),
avgTemp  = col_double()
)
)
temp_data <- read_csv2(
"temperature_data.csv",
col_types = cols(
area     = col_character(),
station  = col_character(),
dateTime = col_date(format = "%d.%m.%Y"),
avgTemp  = col_double()
)
)
temp_data <- temp_data %>%
mutate(
area = as.factor(area),              # convert area to factor
station = as.factor(station),        # convert station to factor
dateTime = as.POSIXct(dateTime),       # convert dateTime to POSIXct (date-time)
avgTemp = as.numeric(gsub(",", ".", avgTemp))
)
# Inspect result
str(temp_data)
summary(temp_data)
head(temp_data)
```{r time-ranges-temp}
time_ranges <- temp_data %>%
# make time-series of each combination of area, station and component
group_by(area, station) %>%
summarise(
# Add start_data and end_date columns
mean_value   = mean(avgTemp),
sd_value     = sd(avgTemp),
min_value    = min(avgTemp),
max_value    = max(avgTemp),
# For getting a clean summary table
.groups = "drop"
)
time_ranges
Comments on summary statistics: Bergen has the highest mean temperature, while Tromsø has the lowest. Bergen also has the highest maximum temperature, while Tromsø has the lowest minimum temperature. The standard deviation is highest in Drammen, indicating more variability in temperature readings there compared to other locations.
c)
```{r}
ggplot(temp_data, aes(x = dateTime, y = avgTemp, color = area, group = area)) +
geom_line() +
labs(
title = "Daily average temperature by area",
x = "Date",
y = "Avg temperature (\u00B0C)"
)
ggplot(temp_data, aes(x = dateTime, y = avgTemp, color = area, group = area)) +
geom_line() +
labs(
title = "Daily average temperature by area",
x = "Date",
y = "Avg temperature (\u00B0C)"
)
ggplot(
temp_data,
aes(x = dateTime, y = avgTemp)
) +
geom_line() +
facet_wrap(~ area, ncol = 2, scales = "free_y") +  # 5 plots/panels
labs(
title = "Daily average temperature by area",
x = "Date",
y = "Avg temperature (\u00B0C)"
)
ggplot(
temp_data,
aes(x = dateTime, y = avgTemp)
) +
geom_line() +
facet_wrap(~ area, ncol = 2, scales = "free_y") +  # 5 plots/panels
labs(
title = "Daily average temperature by area",
x = "Date",
y = "Avg temperature (\u00B0C)"
)
ggplot(
temp_data,
aes(x = dateTime, y = avgTemp)
) +
geom_line() +
facet_wrap(~ area, ncol = 2, scales = "free_y") +  # 5 plots/panels
labs(
title = "Daily average temperature by area",
x = "Date",
y = "Avg temperature (\u00B0C)"
)
d)
```{r}
ggplot(temp_data, aes(x = avgTemp)) +
geom_histogram(bins = 30, color = "white") +
facet_wrap(~ area, ncol = 2) +
labs(title = "Temperature distribution by area",
x = "Avg temperature (\u00B0C)", y = "Count")
ggplot(temp_data, aes(x = avgTemp)) +
geom_histogram(bins = 30, color = "white") +
facet_wrap(~ area, ncol = 2) +
labs(title = "Temperature distribution by area",
x = "Avg temperature (\u00B0C)", y = "Count")
Bergen is unimodal and close to normally distributed.
e)
```{r}
# 1) Build per-day tables
poll_daily <- data %>%
mutate(date = as.Date(dateTime)) %>%
select(area, date, station, component, value)
temp_daily <- temp_data %>%
mutate(date = as.Date(dateTime)) %>%
group_by(area, date) %>%
summarise(avgTemp = mean(avgTemp), .groups = "drop")
# 2) Inner join on (area, date)
df_joined <- inner_join(poll_daily, temp_daily, by = c("area", "date"))
str(df_joined)
head(df_joined, 10)
str(df_joined)
head(df_joined, 10)
f)
df_area <- df_joined %>%
filter(area == area_name, component == pollutant)
ggplot(df_area, aes(x = date)) +
geom_line(aes(y = value, color = "PM2.5"), size = 1) +
geom_line(aes(y = avgTemp, color = "Temperature"), size = 1) +
labs(
title = paste(area_name, "-", pollutant, "and Temperature"),
x = "Date",
y = "Value (µg/m³ or °C)"
) +
scale_color_manual(values = c("PM2.5" = "blue", "Temperature" = "red"), name = "Measurement") +
theme(legend.position = "top")
ggplot(df_area, aes(x = date)) +
geom_line(aes(y = value, color = "PM2.5"), size = 1) +
geom_line(aes(y = avgTemp, color = "Temperature"), size = 1) +
labs(
title = paste(area_name, "-", pollutant, "and Temperature"),
x = "Date",
y = "Value (µg/m³ or °C)"
) +
scale_color_manual(values = c("PM2.5" = "blue", "Temperature" = "red"), name = "Measurement") +
theme(legend.position = "top")
```{r}
area_name <- "Drammen"
pollutant  <- "PM10"
df_area <- df_joined %>%
filter(area == area_name, component == pollutant)
ggplot(df_area, aes(x = date)) +
geom_line(aes(y = value, color = "PM10"), size = 1) +
geom_line(aes(y = avgTemp, color = "Temperature"), size = 1) +
labs(
title = paste(area_name, "-", pollutant, "and Temperature"),
x = "Date",
y = "Value (µg/m³ or °C)"
) +
scale_color_manual(values = c("PM10" = "blue", "Temperature" = "red"), name = "Measurement") +
theme(legend.position = "top")
g)
h)
i,j and k)
df_wide <- df_joined %>%
pivot_wider(names_from = component, values_from = value) #expand df_joined
df_enc <- df_wide %>%
dummy_cols(select_columns = c("area"),
remove_selected_columns = TRUE, # drop original 'area
remove_first_dummy = FALSE) # keep all dummy columns
df_scaled <- df_enc %>%
mutate(across(all_of(num_predictors), ~ as.numeric(scale(.)))) #standard scale
set.seed(123)  # for reproducibility
n <- nrow(df_scaled) #number of rows
idx_train <- sample.int(n, size = floor(0.75 * n)) #(total, 75%)
train_df <- df_scaled[idx_train, ]
test_df  <- df_scaled[-idx_train, ]
####j
train_df <- train_df %>%
select(avgTemp, PM2.5, PM10, starts_with("area_")) #keep only area and pollution
test_df <- test_df %>%
select(avgTemp, PM2.5, PM10, starts_with("area_"))  #keep only area and pollution
lm_model <- lm(avgTemp ~ PM2.5 + PM10 + area_Bergen + area_Drammen + area_Moss, data = train_df)
summary(lm_model)#bigger p -> lower significance
